---
- name: Resize directory
  hosts: all

  tasks:
    - name: Gather machine name
      command: "hostname -s"
      register: machine_name
	  
    - name: Initialize OPT_VAR to opt
      set_fact:
        opt_var: "opt"

    - name: Determine OPT_VAR
      set_fact:
        opt_var: "var"
      when:
        - "machine_name.stdout | regex_search('m5$', ignorecase=True) or machine_name.stdout | regex_search('bis$', ignorecase=True)"

    - name: Determine RL_PATH
      set_fact:
        rl_path: "/dev/rl"
      when:
        - "'/dev/rl' in lookup('fileglob', '/dev/*')"
        - "'/dev/rl_microservices' not in lookup('fileglob', '/dev/*')"
        - "'/dev/rocky' not in lookup('fileglob', '/dev/*')"

    - name: Check RL_PATH and exit if not found
      fail:
        msg: "RL path not found"
      when: rl_path == ""

    - name: Extend logical volume
      command: "lvextend -L {{ f_size }} {{ rl_path }}/{{ opt_var }}"

    - name: Grow XFS filesystem
      command: "xfs_growfs {{ rl_path }}/{{ opt_var }}"
